<!DOCTYPE html>
<meta charset="utf-8">
<%= include_gon %>

<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>

<style>


#loginInfo {
width:100%;
height: 12px;
font-family:  Verdana, Geneva, sans-serif;
}
#username{
float:right;
padding-top: 2px;
padding-right: 4px;
}
#logout{
float:right;
border: 2px solid;
border-radius: 5px;
background-color: #eaeaea;
  margin-left:3px;
padding-left:3px;
padding-right:3px;
}

.chart {
  background-color: #efefef;
}
.chart text {
  fill: black;
  font: 10px sans-serif;
  text-anchor: end;
}

.axis text {
  font: 11px sans-serif;
}

.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.grid-background {
  fill: #ddd;
}

.grid line,
.grid path {
  fill: none;
  stroke: #fff;
  shape-rendering: crispEdges;
}

.grid .minor.tick line {
  stroke-opacity: .5;
}

.brush .extent {
  stroke: #000;
  fill-opacity: .125;
  shape-rendering: crispEdges;
}

.axis text {
  font: 10px sans-serif;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

#PulseAreaDetail{
width:100px;
height:100px;

}

#instructions{
color: gray;
font-family: sans-serif;
}

</style>

<div id="loginInfo">
<div id="logout">logout</div>

<div id="username"></div>

</div>

<h3>CyberDojo Id: <%= params[:id] %>
Avatar: <%= params[:avatar] %>
Kata Name: <%= params[:kataName] %>
</h3>


<body>
<div id="instructions">'a' - mark red cycle : 's' - mark as green cycle : 'd' - mark as blue cycle : 'f' mark as white cycle<br>
left and right arrow - move entire brush left and right <br>
shift + arrow - grow that side : alt (option) + arrow - shrink that side<br>
x - delete all cycles under brush<br>
</div>

<div id="viz"></div>
<svg class="chart"></svg>

<div id="accordion">
</div>


<div id="dialog" style="display:none;">
Please Enter your name:
  <input type="text" value="" id="usernameInput">
</div>

<script>

initializeKeyBindings();

var data = gon.compiles;
var phaseData = gon.phases;
// console.log(phaseData);
compiles = gon.compiles;
cycles = gon.cycles;
// username = gon.username;
username  = $.cookie('username');
// console.log(gon.cycles);

checkLogin();
pageSetup();



// console.log(gon.normalizedPhaseTime);
// console.log(gon.normalizedPhaseSLOC);
// console.log(username);

if(username == null){
//remove bindings before we enter username, they will be readded when page is reloaded
$(document).unbind("keydown");
    $( "#dialog" ).dialog({
                            dialogClass: "no-close",
                            modal: "true",
                            buttons: [
                              {
                                text: "OK",
                                click: function() {
                                  var username = $( "#usernameInput" ).val();
                                  // console.log(username);

                                  // setUserNameCookie(username);
                                  // document.cookie = value;

                                  $.cookie('username', username, { expires: 70000000, path: '/' });

                                  $('#username').html("Hello "+username);
                                  $( this ).dialog( "close" );
                                  window.location.reload();
                                }
                              }
                            ]
    });
  }
  // }


  // TDDData = gon.normalizedPhaseSLOC;
  drawUncatagorizedKata();
  // buildpulseChart(gon.normalizedPhaseSLOC);
  addAllPrexistingMarkup(gon.allMarkups[username]);

  // $.cookie('username', 'the_value', { expires: 7, path: '/' });


  </script>
